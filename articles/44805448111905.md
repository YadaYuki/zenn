---
title: "Nand2tetrisã‚’Goã§å®Ÿè£…ã™ã‚‹ ~ ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ç·¨ ~"
emoji: "ğŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go","nand2tetris","assembly"]
published: false
---

# Nand2tetrisã‚’å®Ÿè£…ã™ã‚‹ãƒ»ç›®æ¬¡ 
1. [Nand2tetrisã‚’å®Ÿè£…ã™ã‚‹  ~ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç·¨(1 ~ 5ç« ) ~](https://zenn.dev/yukiyada/articles/1c5708ddfb36db)
2. **Nand2tetrisã‚’Goã§å®Ÿè£…ã™ã‚‹ ~ ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ç·¨(6ç« ) ~**
3. Nand2tetrisã‚’Goã§å®Ÿè£…ã™ã‚‹ ~ ä¸­é–“è¨€èªãƒ»Virtual Machineç·¨(7,8ç« ) ~ (åŸ·ç­†ä¸­)
4. Nand2tetrisã‚’Goã§å®Ÿè£…ã™ã‚‹ ~ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ç·¨(10,11ç« ) ~ (åŸ·ç­†ä¸­)

# 1.ã¯ã˜ã‚ã«

**ã€Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ä¸­ã§ã¯ä½•ãŒèµ·ã“ã£ã¦ã„ã‚‹ã®ã‹ï¼Ÿã€**
 
è¿‘å¹´ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã‚’å–ã‚Šå·»ãæŠ€è¡“ã¯æ€¥é€Ÿã«ç™ºå±•ã—ã€ã»ã¨ã‚“ã©ã®äººã«ã¨ã£ã¦ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å†…éƒ¨æ§‹é€ ã¯ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹åŒ–ã—ã¦ã„ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚ã‹ãã„ã†ç§ã‚‚ãã®ä¸€äººã€‚ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å†…éƒ¨æ§‹é€ ã‚’çŸ¥ã‚‰ãšã¨ã‚‚ã€ã€ŒæŠ€è¡“ã®ä½¿ã„æ–¹ã€ã•ãˆçŸ¥ã£ã¦ã„ã‚Œã°ã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè£…ã§ãã¦ã—ã¾ã†æ™‚ä»£ã§ã™ã€‚

ã—ã‹ã—ã€ä»®ã«ã‚‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’åä¹—ã‚‹ã®ã§ã‚ã‚Œã°ã€åŸºæœ¬çš„ãªæ§‹é€ ãã‚‰ã„ã¯ç†è§£ã—ã¦ãŠããŸã„ã‚‚ã®ã€‚ãã†æ€ã£ãŸç§ã¯ã€ä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‹‰å¼·ã®ãŸã‚ã«ã€æ›¸ç±ã€Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã®ç†è«–ã¨å®Ÿè£…ã€ãŒæä¾›ã™ã‚‹Nand2tetrisã¨ã„ã†ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å–ã‚Šçµ„ã¿ã¾ã—ãŸã€‚ä»¥ä¸‹ã¯å®Ÿè£…ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã§ã™ã€‚

https://github.com/YadaYuki/nand2tetris-golang

ãã—ã¦ã€æœ¬è¨˜äº‹ã¯ã€Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã®ç†è«–ã¨å®Ÿè£…ã€ã®6ç« ã«è©²å½“ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ç·¨ã®å®Ÿè£…ã«é–¢ã™ã‚‹è¨˜äº‹ã§ã™ã€‚

# 2.ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã®ç†è«–ã¨å®Ÿè£…(Nand2tetris)

æœ¬ç« ã§ã¯ã€Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã®ç†è«–ã¨å®Ÿè£…ã€ã¨ã„ã†æ›¸ç±ã€ã¾ãŸãã®æ›¸ç±ãŒæä¾›ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹Nand2tetrisã«ã¤ã„ã¦ç°¡å˜ã«èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

https://www.oreilly.co.jp/books/9784873117126/

æœ¬æ›¸ã®ç›®çš„ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿéš›ã«ä½œã‚Šã€ãã®ä½œæ¥­ã‚’é€šã—ã¦ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã‚’æ·±ãç†è§£ã™ã‚‹ã“ã¨ã€‚Nand2tetrisã¨ã„ã†ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯NANDã‚²ãƒ¼ãƒˆã‚’æœ€å°ç´ å­ã¨ã—ã¦ã€æ©Ÿæ¢°èªãŒå‹•ä½œã™ã‚‹ã‚ˆã†ãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’æ§‹ç¯‰ã—ã€ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã‚„ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’å®Ÿè£…ã—ã€æœ€çµ‚çš„ã«ã¯ãƒ†ãƒˆãƒªã‚¹ãŒå‹•ä½œã™ã‚‹ã‚ˆã†ãªã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚’æ§‹ç¯‰ã™ã‚‹ã¨ã„ã†ç‰¹å¾´ã‹ã‚‰åä»˜ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

ãã—ã¦ã€æœ¬è¨˜äº‹ãƒ»ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ç·¨ã§ã¯ã€Nand2tetrisãŒæä¾›ã™ã‚‹**Hackã‚¢ã‚»ãƒ³ãƒ–ãƒªã¨ã„ã†ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ã‚¢ã‚»ãƒ³ãƒ–ãƒªè¨€èªã‚’ã€å‰ã®è¨˜äº‹ãƒ»ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç·¨ã§å®Ÿè£…ã—ãŸCPU([CPU.hdl](https://github.com/YadaYuki/nand2tetris-golang/blob/main/hardware/computer/CPU.hdl))ä¸Šã§å‹•ä½œã™ã‚‹ã‚ˆã†ãªæ©Ÿæ¢°èªã«å¤‰æ›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã‚’Goè¨€èªã§å®Ÿè£…ã—ã¾ã™**ã€‚


# 3.ã‚¢ã‚»ãƒ³ãƒ–ãƒªã¨ã¯ï¼Ÿ

å‰ã®è¨˜äº‹(ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç·¨)ã§ã¯ã€16bitæ©Ÿæ¢°èªãŒå‹•ä½œã™ã‚‹ã‚ˆã†ãªã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ»CPUã‚’ä½œæˆã—ã¾ã—ãŸã€‚ã“ã“ã§ã€CPUä¸Šã§å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹16bitæ©Ÿæ¢°èªã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
0000000000000010
1110110000010000
0000000000000011
1110000010010000
0000000000000000
1110001100001000
```
ä¸Šã®æ©Ÿæ¢°èªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€Œ2+3ã®è¨ˆç®—çµæœã‚’ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒ¢ãƒªã®0ç•ªåœ°ã«æ ¼ç´ã™ã‚‹ã€ã¨ã„ã†å˜ç´”ãªå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãªã®ã§ã™ãŒã€**ä¸€ç›®è¦‹ãŸã ã‘ã§ã¯ãã®ã“ã¨ãŒå…¨ãã‚ã‹ã‚‰ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚**(å°‘ãªãã¨ã‚‚ã€ç§ã«ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ)

ã“ã®ã‚ˆã†ã«æ©Ÿæ¢°èªã¨ã„ã†ã®ã¯ç›´æ„Ÿçš„ã«ã¯ç†è§£ã—ã¥ã‚‰ãã€ãã‚Œã‚’ç›´æ¥è¨˜è¿°ã—ã¦ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’çµ„ã‚“ã§ã„ãã€ã¨ã„ã†ã®ã¯äººé–“çš„ãªä½œæ¥­ã¨ã¯è¨€ã„é›£ã„ä¸Šã«ã€åŠ¹ç‡ãŒæ‚ªã„ã§ã™ã€‚**ãã“ã§é–‹ç™ºã•ã‚ŒãŸã®ãŒã‚¢ã‚»ãƒ³ãƒ–ãƒªè¨€èª(ã‚¢ã‚»ãƒ³ãƒ–ãƒª)ã§ã™ã€‚**

ã‚¢ã‚»ãƒ³ãƒ–ãƒªã¯æ©Ÿæ¢°èªã«å¯¾å¿œã™ã‚‹å‘½ä»¤ã‚’"Add R2,R1,R3"ã®ã‚ˆã†ãªè¨˜å·ã®çµ„ã¿åˆã‚ã›ã§è¡¨ç¾ã—ã¾ã™ã€‚ãã—ã¦ã€**ã‚¢ã‚»ãƒ³ãƒ–ãƒªã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ©Ÿæ¢°èªã«å¤‰æ›ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã“ã¨ã‚’ã‚¢ã‚»ãƒ³ãƒ–ãƒ©**ã¨å‘¼ã³ã¾ã™ã€‚

## 4.Hackã‚¢ã‚»ãƒ³ãƒ–ãƒªã®æ–‡æ³•

æ–‡æ³•ã«é–¢ã—ã¦ã€äº‹ç´°ã‹ã«èª¬æ˜ã—ã¦ã„ãå‰ã«ã€å‰ç« ã§æç¤ºã—ãŸã€Œ2+3ã®è¨ˆç®—çµæœã‚’ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒ¢ãƒªã®0ç•ªåœ°ã«æ ¼ç´ã™ã‚‹ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®Hackã‚¢ã‚»ãƒ³ãƒ–ãƒ©ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¾‹ã¨ã—ã¦ã¿ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
@2  // Aãƒ¬ã‚¸ã‚¹ã‚¿ã«2ã‚’æ ¼ç´
D=A // Dãƒ¬ã‚¸ã‚¹ã‚¿ã«A(=2) ã‚’æ ¼ç´
@3
D=D+A  // D ãƒ¬ã‚¸ã‚¹ã‚¿ã«D+A(=2 + 3)ã®è¨ˆç®—çµæœã‚’æ ¼ç´
@0 
M=D // RAM[0]ã«dãƒ¬ã‚¸ã‚¹ã‚¿ã®å€¤ã‚’æ ¼ç´
```

å¤šãã®äººã«ã¨ã£ã¦ã€æ©Ÿæ¢°èªã§æ›¸ã‹ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ˆã‚Šã‚‚ã€å¹¾åˆ†ã€å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã®å†…å®¹ãŒèª­ã¿è§£ãã‚„ã™ããªã£ã¦ã„ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ

Hackã‚¢ã‚»ãƒ³ãƒ–ãƒªã§ã¯ã€å„è¡Œã«è¨˜è¿°ã•ã‚ŒãŸå‘½ä»¤ãƒ»ãƒ©ãƒ™ãƒ«ã§ã‚ã‚‹ã€Œã‚³ãƒãƒ³ãƒ‰ã€ã‚’æœ€å°å˜ä½ã¨ã—ã¦ã€ãã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã¦ã„ãã“ã¨ã«ã‚ˆã£ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚ã“ã“ã§ã€Hackã‚¢ã‚»ãƒ³ãƒ–ãƒªã«ã¯

- Aã‚³ãƒãƒ³ãƒ‰(Aå‘½ä»¤)
- Cã‚³ãƒãƒ³ãƒ‰(Cå‘½ä»¤)
- Lã‚³ãƒãƒ³ãƒ‰(ãƒ©ãƒ™ãƒ«)

ã¨ã„ã†3ã¤ã®æ–‡æ³•ãŒå­˜åœ¨ã—ã¾ã™ã€‚

- **Aã‚³ãƒãƒ³ãƒ‰**

Aã‚³ãƒãƒ³ãƒ‰ã¯`@{å®šæ•° or å¤‰æ•°å}`ã¨ã„ã†æ–‡æ³•ã§è¡¨ã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€Aãƒ¬ã‚¸ã‚¹ã‚¿å†…ã«ä»»æ„ã®å€¤ã‚’æ ¼ç´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã•ã¦ã€Aãƒ¬ã‚¸ã‚¹ã‚¿ã«æ ¼ç´ã•ã‚ŒãŸå€¤ã¯ã©ã‚“ãªç”¨é€”ã«ç”¨ã„ã‚‰ã‚Œã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿå¤§ããåˆ†ã‘ã¦

- æ¼”ç®—å‡¦ç†ã§ç”¨ã„ã‚‰ã‚Œã‚‹å®šæ•°ã®æ ¼ç´
- ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒ¢ãƒªã®ç‰¹å®šã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
- Jumpå‘½ä»¤ã®ã‚¸ãƒ£ãƒ³ãƒ—å…ˆã®æ ¼ç´

ã¨ã„ã†3ã¤ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚

ãŸã¨ãˆã°ã€å…ˆã»ã©ç¤ºã—ãŸã€Œ2+3ã®è¨ˆç®—çµæœã‚’ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒ¢ãƒªã®0ç•ªåœ°ã«æ ¼ç´ã™ã‚‹ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä¸­ã§ã¯ã“ã®ã†ã¡

- **Cã‚³ãƒãƒ³ãƒ‰**

Cã‚³ãƒãƒ³ãƒ‰ã§ã¯ã€åŠ ç®—ã‚„æ¸›ç®—ã€æ¡ä»¶åˆ†å²ã¨ã„ã£ãŸã€Œæ¼”ç®—å‡¦ç†ã€ã‚’è¨˜è¿°ã™ã‚‹Hackã‚¢ã‚»ãƒ³ãƒ–ãƒªã®ä¸­å¿ƒçš„ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚Cã‚³ãƒãƒ³ãƒ‰ã®æ–‡æ³•ã‚’ä¸€èˆ¬åŒ–ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã‚’ã—ã¦ã„ã¾ã™ã€‚

```
dest=comp;jump
```

Cã‚³ãƒãƒ³ãƒ‰ã‚’æ§‹æˆã™ã‚‹è¦ç´ ã®å„å½¹å‰²ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

- dest:compã®ä»£å…¥å…ˆã¨ãªã‚‹ãƒ¬ã‚¸ã‚¹ã‚¿(ex:D,M) 
- comp:è¨ˆç®—å¼(ex:D+1)ã‚„ãƒ¬ã‚¸ã‚¹ã‚¿å
- jump:jumpå‘½ä»¤ã§ã‚ã£ãŸæ™‚ã€ãã®å‘½ä»¤(ex:JGT)

å…ˆã»ã©ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä¸­ã«ç™»å ´ã™ã‚‹Cã‚³ãƒãƒ³ãƒ‰`D=D+A`ã‚’Cã‚³ãƒãƒ³ãƒ‰ã‚’æ§‹æˆã™ã‚‹è¦ç´ ã«åˆ†è§£ã—ã¦ã¿ã‚‹ã¨

- dest:`D`
- comp:`D+A`
- jump:ãªã—

ã¨ãªã‚Šã¾ã™ã€‚

- **Lã‚³ãƒãƒ³ãƒ‰**

æœ€å¾Œã«Lã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚Lã‚³ãƒãƒ³ãƒ‰ã¯Jumpå‘½ä»¤ãŒJumpã™ã‚‹å…ˆã§ã‚ã‚‹ãƒ©ãƒ™ãƒ«ã®å½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚

```
(ADD_FUNCTION) // Lã‚³ãƒãƒ³ãƒ‰
...
...
...
@ADD_FUNCTION
0;JMP // Aãƒ¬ã‚¸ã‚¹ã‚¿ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹(ï¼ADD_FUNCTIONãƒ©ãƒ™ãƒ«ãŒè²¼ã‚‰ã‚Œã¦ã„ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹)ã«ã‚¸ãƒ£ãƒ³ãƒ—
...
```

ä»¥ä¸ŠãŒHackã‚¢ã‚»ãƒ³ãƒ–ãƒªã®æ–‡æ³•ã«é–¢ã™ã‚‹èª¬æ˜ã§ã™ã€‚ãã‚Œã§ã¯æ¬¡ç« ä»¥é™ã§ã¯ã€ã„ã‚ˆã„ã‚ˆãã‚Œã‚‰ã‚’æ©Ÿæ¢°èªã«å¤‰æ›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚


# 5.Hackã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã®Goã«ã‚ˆã‚‹å®Ÿè£…

## 5.1 ã‚¢ã‚»ãƒ³ãƒ–ãƒªãŒæ©Ÿæ¢°èªã«å¤‰æ›ã•ã‚Œã‚‹ã¾ã§

è©³ç´°ãªå®Ÿè£…ã«ã¤ã„ã¦ã¿ã¦ã„ãå‰ã«ã¾ãšã¯å…¨ä½“åƒã§ã™ã€‚ä»Šå›ã€å®Ÿè£…ã—ãŸGoã«ã‚ˆã‚‹Hackã‚¢ã‚»ãƒ³ãƒ–ãƒ©ãŒã€Œã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’æ©Ÿæ¢°èªã«å¤‰æ›ã™ã‚‹ã€ãƒ—ãƒ­ã‚»ã‚¹ã‚’å›³ç¤ºã™ã‚‹ã¨ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚

![image](https://user-images.githubusercontent.com/57289763/143969126-c2fe4a43-b598-4563-9c5f-b04a853f513e.png)

ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’æ©Ÿæ¢°èªã«å¤‰æ›ã™ã‚‹ã¾ã§ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯**ã‚¢ã‚»ãƒ³ãƒ–ãƒªè¨€èªã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã€3ç¨®é¡ã‚ã‚‹ã‚³ãƒãƒ³ãƒ‰ã®ãã‚Œãã‚Œã®æ–‡æ³•ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã—ãŸastãƒãƒ¼ãƒ‰ã®é…åˆ—ã«å¤‰æ›ã™ã‚‹**ã€Œ**æ§‹æ–‡è§£æ**ã€ã¨ **æ§‹æ–‡è§£æã«ã‚ˆã‚Šå¾—ã‚‰ã‚ŒãŸastãƒãƒ¼ãƒ‰ã®é…åˆ—ã®å„è¦ç´ ã‚’æ©Ÿæ¢°èªã«å¤‰æ›ã™ã‚‹**ã€Œ**æ©Ÿæ¢°èªã¸ã®å¤‰æ›**ã€ã¨ã„ã†å¤§ãã2ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã«åˆ†ã‘ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ãã‚Œã§ã¯è©³ç´°ãªå®Ÿè£…ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

## 5.2 assemblerãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

ã¾ãšã¯ã€å®Ÿè£…ã—ãŸHackã‚¢ã‚»ãƒ³ãƒ–ãƒ©([nand2tetris/assembler](https://github.com/YadaYuki/nand2tetris-golang/tree/main/assembler))ã®rootã§ã€`tree`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ä½“åƒã‚’æŠŠæ¡ã—ã¦ã„ãã¾ã™ã€‚

```
$ tree -L 2
.
â”œâ”€â”€ README.md
â”œâ”€â”€ asm // Hackã‚¢ã‚»ãƒ³ãƒ–ãƒªã®ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
â”‚Â Â  â”œâ”€â”€ add
â”‚Â Â  â”œâ”€â”€ max
â”‚Â Â  â”œâ”€â”€ pong
â”‚Â Â  â””â”€â”€ rect
â”œâ”€â”€ ast // 3ç¨®é¡ã®ã‚³ãƒãƒ³ãƒ‰ã®æ–‡æ³•æ§‹é€ ã‚’Goã®æ§‹é€ ä½“ã«ã‚ˆã‚Šå®šç¾©ãƒ»ãƒ¢ãƒ‡ãƒ«åŒ–
â”‚Â Â  â”œâ”€â”€ ast.go
â”‚Â Â  â””â”€â”€ ast_test.go
â”œâ”€â”€ code // astãƒãƒ¼ãƒ‰(astä»¥ä¸‹ã§å®šç¾©ã•ã‚ŒãŸæ§‹é€ ä½“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)ã‚’æ©Ÿæ¢°èªã«å¤‰æ›ã™ã‚‹
â”‚Â Â  â”œâ”€â”€ code.go
â”‚Â Â  â””â”€â”€ code_test.go
â”œâ”€â”€ go.mod
â”œâ”€â”€ main.go // å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã€ã‚¢ã‚»ãƒ³ãƒ–ãƒªâ†’æ©Ÿæ¢°èªã¸ã®å¤‰æ›ã‚’è¡Œã†.
â”œâ”€â”€ main_test.go
â”œâ”€â”€ parser // Hackã‚¢ã‚»ãƒ³ãƒ–ãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’astãƒãƒ¼ãƒ‰ã«å¤‰æ›ã™ã‚‹
â”‚Â Â  â”œâ”€â”€ parser.go
â”‚Â Â  â””â”€â”€ parser_test.go
â”œâ”€â”€ symboltable // ã€ŒLCommadã®ãƒ©ãƒ™ãƒ«åã¨ãã‚Œã«å¯¾å¿œã™ã‚‹æ©Ÿæ¢°èªå‘½ä»¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ»ã€ŒACommandã®å¤‰æ•°åã¨ãã‚Œã«å¯¾å¿œã™ã‚‹RAMã‚¢ãƒ‰ãƒ¬ã‚¹(>16)ã€ã¨ã„ã£ãŸã‚¢ã‚»ãƒ³ãƒ–ãƒªãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã®å¤‰æ•°ã‚’ç®¡ç†ã™ã‚‹ã€‚
â”‚Â Â  â”œâ”€â”€ symboltable.go
â”‚Â Â  â””â”€â”€ symboltable_test.go
â””â”€â”€ value // å®šæ•°å€¤ã®å®šç¾©
    â””â”€â”€ value.go
```

ãã‚Œã§ã¯ã€æ©Ÿæ¢°èªã«å¤‰æ›ã™ã‚‹ä¸Šã§ç‰¹ã«ãƒã‚¤ãƒ³ãƒˆã«ãªã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ã€æ¬¡ç« ä»¥é™ã§è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

## 5.3 æŠ½è±¡æ§‹æ–‡æœ¨(AST)ãƒãƒ¼ãƒ‰ã®å®šç¾©(ast/ast.go)

ast/ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã¯ã€Hackã‚¢ã‚»ãƒ³ãƒ–ãƒªã«å­˜åœ¨ã™ã‚‹3ç¨®é¡ã®ã‚³ãƒãƒ³ãƒ‰ã®æ–‡æ³•æ§‹é€ ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã—ãŸGoã®æ§‹é€ ä½“ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

4ç« ã§Hackã‚¢ã‚»ãƒ³ãƒ–ãƒªã«ã¯

- Aã‚³ãƒãƒ³ãƒ‰
- Cã‚³ãƒãƒ³ãƒ‰
- Lã‚³ãƒãƒ³ãƒ‰

ã¨ã„ã†3ç¨®é¡ã®ã‚³ãƒãƒ³ãƒ‰ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’èª¬æ˜ã—ã¾ã—ãŸã€‚ã“ã®ä¸­ã§ã€ãŸã¨ãˆã°ã€Cã‚³ãƒãƒ³ãƒ‰ã¯ãã®æ§‹é€ ã‚’ä¸€èˆ¬åŒ–ã™ã‚‹ã¨ã€`dest=comp;jump`ã¨ã„ã†æ§‹é€ ã‚’ã—ã¦ãŠã‚Šã€dest,comp,jumpã¨ã„ã†3ã¤ã®è¦ç´ ã‹ã‚‰æ§‹æˆã•ã‚Œã¾ã™(4ç« ã§èª¬æ˜ãšã¿)ã€‚ãã‚Œã§ã¯ã“ã“ã§ã€Cã‚³ãƒãƒ³ãƒ‰ã®æ–‡æ³•æ§‹é€ ã‚’å®šç¾©ã—ãŸæ§‹é€ ä½“CCommandã®å®Ÿè£…ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
type CCommand struct {
	Comp string
	Dest string
	Jump string
}
```
æ§‹é€ ä½“CCommandã¯Comp,Dest,Jumpã¨ã„ã†3ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤æ§‹é€ ä½“ã§ã™ã€‚`dest=comp;jump`ã¨ã„ã†æ§‹é€ ã‚’æŒã¤ã‚¢ã‚»ãƒ³ãƒ–ãƒªã®Cã‚³ãƒãƒ³ãƒ‰ã‚’è§£æã—ã€æ§‹é€ ä½“CCommandã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ãŸå ´åˆã€ãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰Dest,Comp,Jumpã«ã¯ã€ãã‚Œãã‚Œdest,comp,jumpã®æ–‡å­—åˆ—ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã‚Šã¾ã™ã€‚ã“ã®ã‚ˆã†ã«ã—ã¦ã€ä»–ã®Lã‚³ãƒãƒ³ãƒ‰ãƒ»Aã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦ã‚‚ã‚³ãƒãƒ³ãƒ‰ã‚’æ§‹æˆã™ã‚‹è¦ç´ ã‚’ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦æŒã¤ã‚ˆã†ãªæ§‹é€ ä½“ã‚’ãã‚Œãã‚Œå®šç¾©ã—ã¾ã—ãŸã€‚

ãã‚Œã§ã¯ã€Lã‚³ãƒãƒ³ãƒ‰ãƒ»Aã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè£…ãŠã‚ˆã³å„æ§‹é€ ä½“ã®Stringãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…ã‚’å«ã‚“ã ã€ast/ast.goå…¨ä½“ã®å®Ÿè£…ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
package ast

import (
	"assembler/value"
	"fmt"
	"strings"
)

type CommandType string

const (
	A_COMMAND CommandType = "A_COMMAND"
	C_COMMAND CommandType = "C_COMMAND"
	L_COMMAND CommandType = "L_COMMAND"
)

type Command interface {
	String() string
}

type ACommand struct {
	Value    int
	ValueStr string
}

func (aCommand *ACommand) String() string {
	return fmt.Sprintf("@%s", aCommand.ValueStr) + value.NEW_LINE
}

type CCommand struct {
	Comp string
	Dest string
	Jump string
}

func (cCommand *CCommand) String() string {
	commandStr := fmt.Sprintf("%s=%s;%s", cCommand.Dest, cCommand.Comp, cCommand.Jump) + value.NEW_LINE
	if cCommand.Jump == "" {
		commandStr = strings.Replace(commandStr, ";", "", 1)
	} else if cCommand.Dest == "" {
		commandStr = strings.Replace(commandStr, "=", "", 1)
	}
	return commandStr
}

type LCommand struct {
	Symbol string
}

func (lCommand *LCommand) String() string {
	return fmt.Sprintf("(%s)", lCommand.Symbol)
}
```

ä»¥ä¸ŠãŒastãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«é–¢ã™ã‚‹èª¬æ˜ã§ã™ã€‚

## 5.4 æ§‹æ–‡è§£æ(parser.go)
  
## 5.5 æ©Ÿæ¢°èªã¸ã®å¤‰æ›ãƒ»æ§‹æ–‡æœ¨è©•ä¾¡(code.go)
  
## 5.6 Add.asmã‚’æ©Ÿæ¢°èªã«å¤‰æ›ã™ã‚‹.

# 6.æœ€å¾Œã«

