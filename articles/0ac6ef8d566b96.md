---
title: "ã€è„±ãƒ©ãƒ³ã‚¿ã‚¤ãƒ CSS in JSã€‘styled-componentsã‚’åˆ¥ã®CSS in JSã«è‡ªå‹•ç½®æ›ã™ã‚‹CLIãƒ„ãƒ¼ãƒ«ã®é–‹ç™º"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react","css","typescript"]
published: false
---

# 1.ã¯ã˜ã‚ã«

æœ¬è¨˜äº‹ã¯ã‚µã‚¤ãƒœã‚¦ã‚ºã®å¤ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³(2022å¹´)ã§å–ã‚Šçµ„ã‚“ã å†…å®¹ã®ç´¹ä»‹ã‚’è¡Œã„ã¾ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã§ã¯ã€ã‚µã‚¤ãƒœã‚¦ã‚ºã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é ˜åŸŸã«ãŠã‘ã‚‹æ¨ªæ–­çš„çµ„ç¹”ã§ã‚ã‚‹[ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆãƒãƒ¼ãƒ ](https://cybozu.github.io/frontend-expert/)ã«é…å±ã•ã‚Œã¾ã—ãŸã€‚5æ—¥é–“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³æœŸé–“ã§**styled-componentsã‚’åˆ¥ã®CSS in JSã«è‡ªå‹•ç½®æ›ã™ã‚‹CLIãƒ„ãƒ¼ãƒ«ãƒ»extract-styledã®é–‹ç™º**ã«å–ã‚Šçµ„ã¿ã¾ã—ãŸã€‚

# 2. extract-styledã®ç´¹ä»‹

å®Ÿè£…ã—ãŸextract-styledã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªCLIçµŒç”±ã®å®Ÿè¡Œã‚’é€šã—ã¦ã€styled-componentsã§å®šç¾©ã•ã‚ŒãŸReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’`target`ã«æŒ‡å®šã—ãŸä»»æ„ã®CSS in JSã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚(ç¾æ™‚ç‚¹ã§ã¯å¤‰æ›å…ˆã¨ã—ã¦linariaãƒ»vanilla-extractã«å¯¾å¿œ)

```sh
$ extract-styled \\
    --path ./src/components/**/*.tsx \\ # å¤‰æ›å¯¾è±¡ã¨ãªã‚‹styled-componentsã§ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã•ã‚ŒãŸReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®path.
    --target vanilla-extract \\ # å¤‰æ›å…ˆã®CSS in JSã®åå‰ã®åå‰.
    --output ./ \\ # å‡ºåŠ›å…ˆã¨ãªã‚‹path.
    --ignore stories test # ignoreã™ã‚‹path. storybookã¨testã‚’ignore.
```

å¤‰æ›ã®å…·ä½“ä¾‹ã‚’è¦‹ã¦è¦‹ã¾ã—ã‚‡ã†ã€‚`--target vanilla-extract`ã‚’æŒ‡å®šã™ã‚‹ã¨styled-componentsã§å®šç¾©ã•ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ(å¤‰æ›å‰)ã‹ã‚‰vanilla-extractã«ã‚ˆã‚‹ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®å®šç¾©(å¤‰æ›å¾Œ)ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

:::details å¤‰æ›å‰ (styled-componentsã§å®šç¾©ã•ã‚ŒãŸã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°)
```tsx
import styled from 'styled-components';
import * as React from 'react';

type Props = {};

const Button: React.VFC<Props> = () => <button>Button</button>;

const StyledButton = styled(Button)`
  font-size: 1em;
  margin: 1em;
  padding: 0.25em 1em;
  border: 2px solid palevioletred;
  border-radius: 3px;
`;

export { StyledButton as Button };
```
:::

:::details å¤‰æ›å¾Œ (vanilla-extract)
```ts
import { style } from '@vanilla-extract/css';

export const button = style({
  fontSize: '1em',
  margin: '1em',
  padding: '0.25em 1em',
  border: '2px solid palevioletred',
  borderRadius: '3px'
});
```
:::

ä»¥é™ã§ã¯extract-styledã‚’å®Ÿè£…ã—ãŸèƒŒæ™¯ã‚„å†…éƒ¨å®Ÿè£…ã«é–¢ã™ã‚‹èª¬æ˜ã‚’è¡Œã„ã¾ã™ã€‚

# 3. CSS in JSã®ãŠã•ã‚‰ã„

å†…éƒ¨å®Ÿè£…ã‚’è¦‹ã¦ã„ãå‰ã«ã€å‰æçŸ¥è­˜ã¨ã—ã¦ã€CSS in JSã‚’ç°¡å˜ã«ãŠã•ã‚‰ã„ã—ã¾ã™ã€‚CSS in JSã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã€Javascript(Typescript)ã§è¨˜è¿°ã•ã‚ŒãŸReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨åŒä¸€ã®ãƒ•ã‚¡ã‚¤ãƒ«å†…ã«ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

```tsx
import styled from 'styled-components'

interface Props {
    primary?: boolean
}

const Button = styled.button<Props>`
    font-size: 1em;
    margin: 1em;
    padding: 0.25em 1em;
    border: 2px solid palevioletred;
    border-radius: 3px;
`

export function ButtonGroup() {
    return (
        <div>
            <Button>Normal</Button>
            <Button primary>Primary</Button>
        </div>
    )
}
```
CSS in JSã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€Œã‚¯ãƒ©ã‚¹åã®è¡çªã‚’é˜²ãã“ã¨ãŒã§ãã‚‹ã€ã€ŒJSã«ã‚ˆã‚‹å‹•çš„ãªã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®å¤‰åŒ–ã‚’å®¹æ˜“ã«ã€ã‹ã¤ç›´æ„Ÿçš„ã«å®Ÿè£…ã§ãã‚‹ã€ãªã©æ§˜ã€…ãªãƒ¡ãƒªãƒƒãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚CSS in JSã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯æ§˜ã€…ãªé¸æŠè‚¢ãŒå­˜åœ¨ã—ã¾ã™ãŒã€ãã®ä¸­ã§ã‚‚ã€æœ€ã‚‚ã‚ˆãçŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸€ã¤ãŒ[styled-components](https://styled-components.com/)ã§ã™ã€‚

# 4. styled-componentsç§»è¡Œæ¤œè¨ã®èƒŒæ™¯

ã“ã“ã§ã¯ã€ã‚µã‚¤ãƒœã‚¦ã‚ºç¤¾å†…ã§styled-componentsã®ç§»è¡Œã‚’æ¤œè¨ã™ã‚‹ã«è‡³ã£ãŸèƒŒæ™¯ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ç¾åœ¨ã€ã‚µã‚¤ãƒœã‚¦ã‚ºã®å¤šãã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§styled-componentsã«ã‚ˆã‚Šã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ãŒæ–½ã•ã‚ŒãŸReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

styled-componentsã®é‡è¦ãªç‰¹å¾´ã®ä¸€ã¤ã¨ã—ã¦ã€ãƒ“ãƒ«ãƒ‰å¾Œã«é™çš„ãªCSSãƒ•ã‚¡ã‚¤ãƒ«(`.css`)ã‚’ç”Ÿæˆã›ãšã€Javascriptã®å®Ÿè¡Œã«ã‚ˆã‚Šå…¨ã¦ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚’æ–½ã™ã¨ã„ã†ç‚¹ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã€styled-componentsã‚’å‡Œãä»£è¡¨çš„ãªCSS in JSã§ã‚ã‚‹[emotion](https://emotion.sh/)ã‚‚åŒæ§˜ã§ã™ã€‚

ã“ã‚Œã‚‰ã®CSS in JSãŒæ¡ç”¨ã™ã‚‹ã€ŒJavascriptã®å®Ÿè¡Œã«ã‚ˆã‚Šã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚’æ–½ã™ã€ã¨ã„ã†æ–¹æ³•ã¯ã€Œå¤‰æ•°ãƒ»propsç­‰ã‚’æ´»ç”¨ã—ãŸå‹•çš„ãªCSSã®å®Ÿè£…ãŒã—ã‚„ã™ã„ã€ãªã©ãƒ¡ãƒªãƒƒãƒˆã‚‚ã‚ã‚Šã¾ã™ãŒã€**ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã€JavaScriptã®å®Ÿè¡Œã«ã‚ˆã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒç”Ÿã˜ã¦ã—ã¾ã†ã¨ã„ã†ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä¸Šã®èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚**

ä¸€æ–¹ã§[CSS modules](https://github.com/css-modules/css-modules)ã‚„[linaria](https://github.com/callstack/linaria)ãƒ»[vanilla-extract](https://vanilla-extract.style/)ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹zero-runtime CSS in JSãªã©ã§ã¯ã€ãƒ“ãƒ«ãƒ‰å¾Œã«é™çš„ãªCSSãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã€ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚‚ãã‚Œã‚‰(`.css`)ã‹ã‚‰æ–½ã•ã‚Œã¾ã™ã€‚

ã€ŒJavascriptã®å®Ÿè¡Œã«ã‚ˆã‚‹ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã€ã¨ã€Œé™çš„ãªCSSãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã€ã®ã©ã¡ã‚‰ãŒæ—©ã„ã‹ã¯ã‚±ãƒ¼ã‚¹ãƒã‚¤ã‚±ãƒ¼ã‚¹ã§ã™ãŒã€å¾Œè€…ã®æ–¹ãŒãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é¢ã§ã¯å„ªã‚Œã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚

å…ˆæ—¥è©±é¡Œã«ãªã£ãŸEmotionã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼ã«ã‚ˆã‚‹Emotionã¨Sass Modules(é™çš„ãªCSSã‚’å‡ºåŠ›)ã‚’ç”¨ã„ãŸãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚é–“ã®æ¯”è¼ƒå®Ÿé¨“ ( [Link](https://dev.to/srmagura/why-were-breaking-up-wiht-css-in-js-4g9b) )ã§ã¯ã€**Emotionã¨æ¯”ã¹ã€Sass Modulesã®æ–¹ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«ã‹ã‹ã‚‹æ™‚é–“ãŒç´„48%ã‚‚çŸ­ã‹ã£ãŸã“ã¨**ãŒå ±å‘Šã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã†ã„ã£ãŸstyled-componentsã‚’ã¯ã˜ã‚ã¨ã™ã‚‹runtime CSS in JSã®å•é¡Œç‚¹ã‹ã‚‰ã€æ–­å®šã¯ã§ãã¾ã›ã‚“ãŒã€**å°†æ¥çš„ã«styled-componentsãŒä½¿ç”¨ã•ã‚ŒãŸReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè² å‚µåŒ–ã™ã‚‹å¯èƒ½æ€§ãŒæ‡¸å¿µã•ã‚Œã¾ã™**ã€‚ãã®ãŸã‚ã€ãã‚Œã‚‰ã‚’ã€ä¸»ã«zero-runtime CSS in JSã‚’ã¯ã˜ã‚ã¨ã™ã‚‹ä»–ã®CSS in JSã«ç§»è¡Œã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã™ã‚‹ã«è‡³ã‚Šã¾ã—ãŸã€‚

ä»¥ä¸Šã®èƒŒæ™¯ã‹ã‚‰ã€styled-componentsã§å®šç¾©ã•ã‚ŒãŸReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä»–ã®CSS in JSã«ã‚ˆã‚‹ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã«è‡ªå‹•ã§å¤‰æ›ã™ã‚‹extract-styledã®é–‹ç™ºã«å–ã‚Šçµ„ã¿ã¾ã—ãŸã€‚

# 5. å®Ÿè£…

æœ¬ç« ã§ã¯extract-styledã®å†…éƒ¨å®Ÿè£…ã«é–¢ã™ã‚‹èª¬æ˜ã‚’è¡Œã„ã¾ã™ã€‚ã¾ãšã¯ã€extract-styledã®ã‚³ã‚¢æ©Ÿèƒ½ã§ã‚ã‚‹JSXã‚³ãƒ¼ãƒ‰ã®å¤‰æ›ã«é–¢ã™ã‚‹æ¦‚è¦å›³ã‚’è¦‹ã¦è¦‹ã¾ã—ã‚‡ã†

![image](https://user-images.githubusercontent.com/57289763/198820067-80a20517-a47f-431c-b62d-fdd3ed1b5a4c.png)

æ¦‚è¦å›³ã‹ã‚‰ã‚ã‹ã‚‹é€šã‚Šã€JSXã‚³ãƒ¼ãƒ‰ã®å¤‰æ›ã¯ã€ŒJSXã®ASTå–å¾—(æ§‹æ–‡è§£æ)ã€ã¨ã€Œå„CSS in JSã¸ã®å¤‰æ›ã€ã¨ã„ã†å¤§ãã2ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã«åˆ†ã‘ã‚‰ã‚Œã¾ã™ã€‚

## 5.1 JSXã®ASTå–å¾—(æ§‹æ–‡è§£æ)

extract-styledã§ã¯ã€å¤‰æ›å¯¾è±¡ã¨ãªã‚‹styled-componentsã«ã‚ˆã‚Šã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã•ã‚ŒãŸReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ASTã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚

ã“ã“ã§ã€ASTã«é–¢ã—ã¦ç°¡å˜ã«èª¬æ˜ã‚’è¡Œã„ã¾ã™ã€‚AST (Abstract Syntax Tree, æŠ½è±¡æ§‹æ–‡æœ¨)ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æœ¨æ§‹é€ ã§æ§‹é€ çš„ã«è¡¨ç¾ã—ãŸã‚‚ã®ã‚’æŒ‡ã—ã¾ã™ã€‚ã“ã“ã§ã¯ä¸€ä¾‹ã¨ã—ã¦ã€`const hoge = 1 + 1;`ã«å¯¾ã™ã‚‹ASTã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![const hoge= 1 + 1;ã®AST](https://user-images.githubusercontent.com/57289763/198824430-93dab853-ac17-44ac-af7d-c417d894f50e.png)

Javascript(Typescript)ã®å ´åˆã€ASTã‚’JSONå½¢å¼ã§å–å¾—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ãªãŠã€ASTã®ç”Ÿæˆã¯[ã“ã¡ã‚‰](https://astexplorer.net/)ã®ã‚µã‚¤ãƒˆã‹ã‚‰ç°¡å˜ã«è©¦ã›ã¾ã™ã€‚

Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã€ASTã¨ã„ã†æœ¨æ§‹é€ ã®ä¸­é–“è¡¨ç¾ã‚’å–å¾—ã™ã‚‹ã“ã¨ã§ã€å¿…è¦æƒ…å ±ã®æ¢ç´¢ã‚„ã‚³ãƒ¼ãƒ‰ã®ä¸Šæ›¸ãç­‰ã®ä½œæ¥­ãŒã‚„ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚

extract-styledã§ã¯ã€ASTã®ç”Ÿæˆã‚’[@babel/parser](https://babeljs.io/docs/en/babel-parser)ã«ã‚ˆã£ã¦å®Ÿè£…ã—ã¾ã—ãŸã€‚@babel/parserã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€JSXã‚’å«ã‚ãŸJavascript(Typescript)ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ASTã‚’ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãŸã£ãŸæ•°è¡Œã®ã‚³ãƒ¼ãƒ‰ã§å–å¾—ã§ãã¾ã™ã€‚

```ts
import fs from 'node:fs/promises';
import { parse } from '@babel/parser';

const jsxCode = await fs.readFile('{path to jsx(tsx)}', 'utf-8'); // jsxãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
const ast = parse(jsxCode, {
  plugins: ['typescript', 'jsx'],
  sourceType: 'module'
}); // AST(JSONå½¢å¼)ã‚’ç”Ÿæˆ
```

ã“ã®ã‚ˆã†ã«ã—ã¦å–å¾—ã—ãŸJSONå½¢å¼ã®ASTã‚’ã€[@babel/traverse](https://babeljs.io/docs/en/babel-traverse)ç­‰ã§æ¢ç´¢ã—ã€Œstyled-componentsã«ã‚ˆã‚‹ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®å®šç¾©ã€ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹å¿…è¦æƒ…å ±ã‚’æŠ½å‡ºã—ã¾ã—ãŸã€‚æŠ½å‡ºã—ãŸæƒ…å ±ã‚’ç”¨ã„ã¦ã€å¤‰æ›å…ˆã¨ã—ã¦æŒ‡å®šã•ã‚ŒãŸCSS in JSã®å½¢å¼ã«æ²¿ã£ãŸã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚’ç”Ÿæˆã—ã¾ã™ã€‚æ¬¡ç« ã§ã¯vanilla-extractã‚’ä¾‹ã«ã€å„CSS in JSã¸ã®å¤‰æ›ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†

## 5.2 å„CSS in JSã¸ã®å¤‰æ› (vanilla-extract)

ã“ã“ã§ã¯ã€vanilla-extractã‚’ä¾‹ã«ã€5.1ã§å–å¾—ã—ãŸæƒ…å ±ã‚’ç”¨ã„ãŸCSS in JSã®ç”Ÿæˆã‚’è¦‹ã¦ã„ãã¾ã™ã€‚styled-componentsâ†’vanilla-extractã®å¤‰æ›ä¾‹ã¯[2ç« ](#2-extract-styledã®ç´¹ä»‹)ã«æ²è¼‰ãŒã‚ã‚Šã¾ã™ã€‚

5.1ã§å–å¾—ã—ãŸstyled-componentsã§å®šç¾©ã•ã‚ŒãŸã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã¯propsã«ã‚ˆã‚‹å‹•çš„ãªã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ç­‰ã®ä¾‹å¤–ã‚’é™¤ã„ã¦ã€å½¢å¼ã¯CSSã¨åŒã˜ã§ã™ã€‚ãã“ã§ã€ã¾ãšã¯CSSã®æƒ…å ±ã‚’æŠ½å‡ºã™ã¹ãã€[stylis](https://stylis.js.org/)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ç”¨ã„ã¦CSSã®ASTã‚’å–å¾—ã—ã¾ã—ãŸã€‚@babel/parseråŒæ§˜ã€stylisã«ã‚ˆã‚‹ASTã®å–å¾—ã‚‚ç°¡å˜ã«å®Ÿè£…ãŒã§ãã¾ã™ã€‚

```ts
import { compile } from 'stylis';

const cssCode = `...cssã®å®Ÿè£…...`
const cssAst: CssNode[] = compile(cssCode); // ASTã‚’ç”Ÿæˆ
```

å–å¾—ã—ãŸCSSã®ASTã‚’vanilla-extractã«å¤‰æ›ã—ã¾ã™ã€‚ã“ã‚Œã«ã¯ã€CSSã®ASTã‚’å†å¸°çš„ã«æ¢ç´¢ã—ã€vanilla-extractã®å½¢å¼ã«å¤‰æ›ã™ã‚‹`generateVanillaCode`ã¨ã„ã†é–¢æ•°ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ãŒå®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚

```ts
import { camelCase } from 'camel-case';
import { CssNode } from '../types';

/**
 * CSSã®ASTã‹ã‚‰Objectå½¢å¼ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚’ç”Ÿæˆã™ã‚‹.
 */
const generateCssObject = (ast: CssNode[], keyRoot: string) => {
  let objects: Record<string, Record<string, string>> = {};
  const generatHelper = (node: CssNode[], key: string) => {
    for (const n of node as CssNode[]) {
      if (!Array.isArray(n.children)) {
        objects[key] = {
          ...objects[key],
          [camelCase(n.props)]: n.children as string
        };
      } else {
        generatHelper(n.children, camelCase(`${key}-${n.props[0]}`));
      }
    }
  };
  generatHelper(ast, keyRoot);
  return objects;
};
/**
 * CSSã®ASTã‹ã‚‰vanilla-extractã®ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹.
 */
export const generateVanillaCode = (ast: CssNode[], keyRoot: string) => {
  const cssObject = generateCssObject(ast, keyRoot);

  const styleCode = Object.entries(cssObject)
    .map(([key, value]) => {
      return `
      export const ${key} = style(${JSON.stringify(value)});
    `;
    })
    .join('');

  const code = `
  import { style } from '@vanilla-extract/css';
  ${styleCode}
  `;
  return code;
};
```


# 6. ã¾ã¨ã‚
ä»¥ä¸ŠãŒextract-styledã®ç´¹ä»‹ã«ãªã‚Šã¾ã™ã€‚ä»Šå›é–‹ç™ºã—ãŸextract-styledã«ã‚ˆã£ã¦ã€styled-componentsã§å®šç¾©ã•ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä»»æ„ã®CSS in JSã«è‡ªå‹•ã§ç½®æ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚extract-styledã¯ã€ŒJSã‚’ç”¨ã„ãŸå‹•çš„ãªã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ãŒæœªå¯¾å¿œã§ã‚ã‚‹ç‚¹ã€ã‚„ã€Œå¤‰æ›å…ˆã®CSS in JSãŒé™ã‚‰ã‚Œã¦ã„ã‚‹ã€æ©Ÿèƒ½é¢ã§ã¯ã¾ã ã¾ã æœªå®Œæˆãªéƒ¨åˆ†ã‚‚å¤šã„ã§ã™ã€‚

extract-styledã®é–‹ç™ºã‚’é€šã—ã¦è§¦ã‚ŒãŸJSã®æ§‹æ–‡è§£æã‚„ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãªã©ã®å®Ÿè£…ã¯ã€æ™®æ®µã®é–‹ç™ºã§ã¯ä¸­ã€…å¾—ã‚‹ã“ã¨ãŒã§ããªã„çµŒé¨“ã§ã—ãŸã€‚5æ—¥é–“ã¨ã„ã†çŸ­ã„æœŸé–“ã§ã¯ã‚ã‚Šã¾ã—ãŸãŒã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã‚’é€šã—ã¦ã€å®Ÿéš›ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åŸºç›¤ã‚’æ”¹å–„ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã«æºã‚ã‚ŒãŸã“ã¨ã¯éå¸¸ã«å¬‰ã—ã‹ã£ãŸã§ã™ã€‚

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã®æ–¹ã€…ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã‚’ä¼ç”»ã—ã¦ãã ã•ã£ãŸäººäº‹ã®æ–¹ã€…ã«æ”¹ã‚ã¦å¾¡ç¤¼ç”³ã—ä¸Šã’ã¾ã™ã€‚æœ¬å½“ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼

# 7. å‚è€ƒæ–‡çŒ®ãƒ»é–¢é€£è³‡æ–™

https://dev.to/srmagura/why-were-breaking-up-wiht-css-in-js-4g9b

https://github.com/emotion-js/emotion/blob/bcf40cf2c201534813f7e3070aacd59e9f674f6f/docs/extract-static.mdx

https://github.com/styled-components/styled-components/issues/2377

https://github.com/styled-components/styled-components/issues/1018

https://uit-inside.linecorp.com/episode/108

https://blog.logrocket.com/comparing-the-top-zero-runtime-css-in-js-libraries/

https://speakerdeck.com/yadayuki/saibouzuhurontoendoekisupatokosu