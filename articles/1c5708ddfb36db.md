---
title: "Nand2tetrisã‚’å®Ÿè£…ã™ã‚‹  ~ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç·¨(1 ~ 5ç« )~"
emoji: "ğŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nand2tetris","cpu"]
published: true
---
# Nand2tetrisã‚’å®Ÿè£…ã™ã‚‹ãƒ»ç›®æ¬¡ 
1. **Nand2tetrisã‚’å®Ÿè£…ã™ã‚‹  ~ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç·¨(1 ~ 5ç« ) ~**
2. [Nand2tetrisã‚’Goã§å®Ÿè£…ã™ã‚‹ ~ ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ç·¨(6ç« ) ~](https://zenn.dev/yukiyada/articles/44805448111905)
3. [Nand2tetrisã‚’Goã§å®Ÿè£…ã™ã‚‹ ~ ä¸­é–“è¨€èªãƒ»Virtual Machineç·¨(7,8ç« ) ~](https://zenn.dev/yukiyada/articles/44805448111905)
4. Nand2tetrisã‚’Goã§å®Ÿè£…ã™ã‚‹ ~ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ç·¨(10,11ç« ) ~ (åŸ·ç­†ä¸­)


# 1.ã¯ã˜ã‚ã«

**ã€Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ä¸­ã§ã¯ä½•ãŒèµ·ã“ã£ã¦ã„ã‚‹ã®ã‹ï¼Ÿã€**
 
è¿‘å¹´ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã‚’å–ã‚Šå·»ãæŠ€è¡“ã¯æ€¥é€Ÿã«ç™ºå±•ã—ã€ã»ã¨ã‚“ã©ã®äººã«ã¨ã£ã¦ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å†…éƒ¨æ§‹é€ ã¯ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹åŒ–ã—ã¦ã„ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚ã‹ãã„ã†ç§ã‚‚ãã®ä¸€äººã€‚ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å†…éƒ¨æ§‹é€ ã‚’çŸ¥ã‚‰ãšã¨ã‚‚ã€ã€ŒæŠ€è¡“ã®ä½¿ã„æ–¹ã€ã•ãˆçŸ¥ã£ã¦ã„ã‚Œã°ã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè£…ã§ãã¦ã—ã¾ã†æ™‚ä»£ã§ã™ã€‚

ã—ã‹ã—ã€ä»®ã«ã‚‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’åä¹—ã‚‹ã®ã§ã‚ã‚Œã°ã€åŸºæœ¬çš„ãªæ§‹é€ ãã‚‰ã„ã¯ç†è§£ã—ã¦ãŠããŸã„ã‚‚ã®ã€‚ãã†æ€ã£ãŸç§ã¯ã€ä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‹‰å¼·ã®ãŸã‚ã«ã€æ›¸ç±ã€Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã®ç†è«–ã¨å®Ÿè£…ã€ãŒæä¾›ã™ã‚‹Nand2tetrisã¨ã„ã†ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å–ã‚Šçµ„ã¿ã¾ã—ãŸã€‚ä»¥ä¸‹ã¯å®Ÿè£…ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã§ã™ã€‚

https://github.com/YadaYuki/nand2tetris-golang

ãã—ã¦ã€æœ¬è¨˜äº‹ã¯ã€Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã®ç†è«–ã¨å®Ÿè£…ã€ã®1ç« ã‹ã‚‰5ç« ã«è©²å½“ã™ã‚‹ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç·¨ã®å®Ÿè£…ã«é–¢ã™ã‚‹è¨˜äº‹ã§ã™ã€‚

# 2.ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã®ç†è«–ã¨å®Ÿè£…(Nand2tetris)

æœ¬ç« ã§ã¯ã€Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã®ç†è«–ã¨å®Ÿè£…ã€ã¨ã„ã†æ›¸ç±ã€ã¾ãŸãã®æ›¸ç±ãŒæä¾›ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹Nand2tetrisã«ã¤ã„ã¦ç°¡å˜ã«èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

https://www.oreilly.co.jp/books/9784873117126/

æœ¬æ›¸ã®ç›®çš„ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿéš›ã«ä½œã‚Šã€ãã®ä½œæ¥­ã‚’é€šã—ã¦ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã‚’æ·±ãç†è§£ã™ã‚‹ã“ã¨ã€‚Nand2tetrisã¨ã„ã†ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯NANDã‚²ãƒ¼ãƒˆã‚’æœ€å°ç´ å­ã¨ã—ã¦ã€æ©Ÿæ¢°èªãŒå‹•ä½œã™ã‚‹ã‚ˆã†ãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’æ§‹ç¯‰ã—ã€ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã‚„ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’å®Ÿè£…ã—ã€æœ€çµ‚çš„ã«ã¯ãƒ†ãƒˆãƒªã‚¹ãŒå‹•ä½œã™ã‚‹ã‚ˆã†ãªã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚’æ§‹ç¯‰ã™ã‚‹ã¨ã„ã†ç‰¹å¾´ã‹ã‚‰åä»˜ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

ãã—ã¦ã€æœ¬è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç·¨ã§ã¯ã€NANDã‚²ãƒ¼ãƒˆãƒ»Dãƒ•ãƒªãƒƒãƒ—ãƒ•ãƒ­ãƒƒãƒ—ã¨ã„ã£ãŸã‚·ãƒ³ãƒ—ãƒ«ã§å˜ç´”ãªå›è·¯ã‚’çµ„ã¿åˆã‚ã›ã¦ã€CPUã‚„ALUã¨ã„ã£ãŸè¤‡é›‘ãªå›è·¯ã‚’ãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—ã«æ§‹ç¯‰ã—ã¦ã„ãã€æœ€çµ‚çš„ã«ã¯æ©Ÿæ¢°èªãŒå‹•ä½œã™ã‚‹ã‚ˆã†ãªãƒã‚¤ãƒãƒ³å‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å®Ÿè£…ã‚’è¡Œã„ã¾ã™ã€‚

# 3.ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç·¨(1 ~ 5ç« )

## 3.1.ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¨˜è¿°è¨€èª(HDL)

ã•ã¦ã€ãã‚Œã§ã¯ã“ã“ã‹ã‚‰ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’å®Ÿè£…ã—ã¦ã„ãã‚ã‘ã§ã™ãŒã€å®Ÿè£…ã™ã‚‹éš›ã¯å®Ÿç‰©ã®å›è·¯ã‚’å°ç·šã§ç¹‹ãã€çµ„ã¿ç«‹ã¦ã¦ã„ãã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ãƒ‡ã‚¸ã‚¿ãƒ«å›è·¯ã®è¨­è¨ˆã‚’ã™ã‚‹éš›ã«ç”¨ã„ã‚‰ã‚Œã‚‹ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¨˜è¿°è¨€èª(HDL)ã‚’ä½¿ã£ã¦ã€å›è·¯ã®è¨­è¨ˆãƒ»æ§‹æˆã‚’è¨˜è¿°ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯Nand2tetrisãŒæä¾›ã™ã‚‹HDLã®æ–‡æ³•ã§ã™(ANDã‚²ãƒ¼ãƒˆã®å®Ÿè£…)ã€‚

```
CHIP And {
    IN a, b;
    OUT out;
    PARTS:
    Nand (a=a,b=b,out=out1);
    Not(in=out1,out=out);
}
```

ãã—ã¦ã€ä¸€èˆ¬çš„ãªHDLã¨åŒæ§˜ã€å›è·¯ã«å¯¾ã™ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚‚ã€Nand2tetrisã®å…¬å¼ã‚µã‚¤ãƒˆã§æä¾›ã•ã‚Œã¦ã„ã¾ã™.ã“ã‚Œã«ã‚ˆã£ã¦ã€è‡ªåˆ†ãŒå®Ÿè£…ã—ãŸå›è·¯ãŒæ„å›³ã—ãŸå‹•ä½œã‚’ã™ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã®ã‚ˆã†ãªé–‹ç™ºç’°å¢ƒã§ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®å®Ÿè£…ã«å–ã‚Šçµ„ã‚“ã§ã„ãã¾ã—ãŸã€‚

## 3.3.çµ„ã¿åˆã‚ã›å›è·¯ã®å®Ÿè£…

ãã‚Œã§ã¯æ—©é€Ÿã€å›è·¯ã®å®Ÿè£…ã«å–ã‚Šçµ„ã‚“ã§ã„ãã¾ã—ã‚‡ã†ã€‚ã¨ã„ã£ã¦ã‚‚ã€ã„ããªã‚ŠCPUã‚„ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¨ã„ã£ãŸè¤‡é›‘ãªå›è·¯ã®æ§‹ç¯‰ã‚’è¡Œã†ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€Nandã‚²ãƒ¼ãƒˆã‚’é…ç·šã—ã€ORã‚„ANDã¨ã„ã£ãŸæ¯”è¼ƒçš„ã‚·ãƒ³ãƒ—ãƒ«ãªçµ„ã¿åˆã‚ã›å›è·¯ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

ã•ã¦ã€å…·ä½“çš„ãªå®Ÿè£…ã«ç§»ã£ã¦ã„ãå‰ã«ã€ãã‚‚ãã‚‚ã€Œçµ„ã¿åˆã‚ã›å›è·¯ã€ã¨ã¯ãªã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿ  
çµ„ã¿åˆã‚ã›å›è·¯ã¨ã¯ä¸€è¨€ã§è¨€ã†ã¨ã€ã€Œ**çŠ¶æ…‹ã‚’æŒãŸãšã€å…¥åŠ›ã«ã‚ˆã£ã¦ã®ã¿ã€å‡ºåŠ›ãŒæ±ºã¾ã‚‹å›è·¯**ã€ã§ã™ã€‚ä¾‹ã¨ã—ã¦ã¯ã€AND,ORã¨ã„ã£ãŸåŸºæœ¬çš„ãªè«–ç†å›è·¯ã€åŠ ç®—å™¨ã‚„ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µã¨ã„ã£ãŸå›è·¯ã‚‚ã€ŒçŠ¶æ…‹ã‚’æŒãŸãšã€å…¥åŠ›ã«ã‚ˆã£ã¦ã®ã¿å‡ºåŠ›ãŒæ±ºã¾ã‚‹ã€ã¨ã„ã†æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ãŸã‚ã€çµ„ã¿åˆã‚ã›å›è·¯ã«å½“ãŸã‚Šã¾ã™ã€‚

ãã—ã¦ã€å½“ç„¶ã§ã™ãŒã€Nandã‚²ãƒ¼ãƒˆè‡ªèº«ã‚‚ã€ŒçŠ¶æ…‹ã‚’æŒãŸãšã€å…¥åŠ›ã«ã‚ˆã£ã¦ã®ã¿ã€å‡ºåŠ›ãŒæ±ºã¾ã‚‹å›è·¯ã€ã¨ã„ã†æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ãŸã‚ã€çµ„ã¿åˆã‚ã›å›è·¯ã®ä¸€ã¤ã§ã™ã€‚ã“ã“ã§ã€æœ€å°ç´ å­ã¨ãªã‚‹Nandã‚²ãƒ¼ãƒˆã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã€å…¥åŠ›ã‚’X,Y,å‡ºåŠ›ã‚’outã¨ã—ãŸä¸‹å›³ã®ã‚ˆã†ãªNandã‚²ãƒ¼ãƒˆã¨ãã®çœŸç†å€¤è¡¨ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†.

![image](https://user-images.githubusercontent.com/57289763/142960380-0a8d75e9-7d37-46c0-8102-93d523d6c7a7.png)


![image](https://user-images.githubusercontent.com/57289763/143578662-3542b5d6-5ff7-4069-a199-c60246359fe1.png)


ä¸Šã«ç¤ºã™ã‚ˆã†ã«ã€çµ„ã¿åˆã‚ã›å›è·¯ã¯çœŸç†å€¤è¡¨ã«ã‚ˆã£ã¦å…¨ã¦ã®å…¥åŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãã‚Œã«å¯¾ã™ã‚‹å‡ºåŠ›ã‚’ç¤ºã™ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚æœ¬æ›¸ã§ã¯ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢å®Ÿè£…ã®ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€ä¸Šã®å›³ã«ç¤ºã—ãŸæ§˜ãªNandã‚²ãƒ¼ãƒˆã‹ã‚‰ã€è¤‡æ•°ã®çµ„ã¿åˆã‚ã›å›è·¯ã®å®Ÿè£…ã«å–ã‚Šçµ„ã¿ã¾ã™ã€‚

å®Ÿè£…ã—ãŸçµ„ã¿åˆã‚ã›å›è·¯ã‚’ä¸€ã¤ä¸€ã¤èª¬æ˜ã—ã¦ã„ãŸã‚‰é•·ããªã‚‹ã®ã§ã€ã“ã“ã§ã¯ä¸€ä¾‹ã¨ã—ã¦ã€Nandã‚²ãƒ¼ãƒˆã¨Notã‚²ãƒ¼ãƒˆ(ã™ã§ã«å®Ÿè£…æ¸ˆã¿ã¨æƒ³å®š)ã«ã‚ˆã‚‹Andã‚²ãƒ¼ãƒˆã®å®Ÿè£…ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
CHIP And {
    IN a, b;
    OUT out;
    PARTS:
    Nand (a=a,b=b,out=out1); 
    Not(in=out1,out=out); // Nandã‚²ãƒ¼ãƒˆã®å‡ºåŠ›(out1)ã‚’åè»¢ã•ã›ã‚‹ã€‚
}
```

Andã‚²ãƒ¼ãƒˆã¯Nandã‚²ãƒ¼ãƒˆã®å‡ºåŠ›ã®è£œé›†åˆãªã®ã§ã€Nandã‚²ãƒ¼ãƒˆã®å‡ºåŠ›out1ã‚’Notã§åè»¢ã•ã›ã‚‹ã“ã¨ã«ã‚ˆã£ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã“ã®ã‚ˆã†ã«ã—ã¦ã€Nandã‚²ãƒ¼ãƒˆã‚’æœ€å°ç´ å­ã¨ã—ãŸçµ„ã¿åˆã‚ã›å›è·¯ã®å®Ÿè£…ã«å–ã‚Šçµ„ã¿ã¾ã—ãŸã€‚å®Ÿè£…ã—ãŸçµ„ã¿åˆã‚ã›å›è·¯ã«ã¤ã„ã¦ã€è©³ç´°ã«ã¯èª¬æ˜ã—ã¾ã›ã‚“ãŒã€å®Ÿè£…ã«èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã®[nand2tetris/hardware/bool_gate](https://github.com/YadaYuki/nand2tetris-golang/tree/main/hardware/bool_gate)ä»¥ä¸‹ã®HDLãƒ•ã‚¡ã‚¤ãƒ«(*.hdl)ã‚’è¦‹ã¦ã¿ã¦ãã ã•ã„ã€‚

## 3.4.ALU(ç®—è¡“è«–ç†æ¼”ç®—å™¨)ã®å®Ÿè£…

å‰ç« ã§ã¯è¤‡æ•°ã®çµ„ã¿åˆã‚ã›å›è·¯ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ãã—ã¦æœ¬ç« ã§ã¯ã€çµ„ã¿åˆã‚ã›å›è·¯ã®é›†å¤§æˆã¨ã‚‚è¨€ãˆã‚‹ç®—è¡“è«–ç†æ¼”ç®—å™¨ãƒ»ALUã®å®Ÿè£…ã‚’è¡Œã„ã¾ã™ã€‚

ALUã®å®Ÿè£…ã‚’è¦‹ã¦ã„ãå‰ã«ã€ALUã«é–¢ã™ã‚‹èª¬æ˜ã§ã™ã€‚
ã€ŒALUã¨ã¯ä½•ã‹?ã€ã«ã¤ã„ã¦ã§ã™ãŒã€æ›¸ç±ã€Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®æ§‹æˆã¨è¨­è¨ˆã€(é€šç§°ãƒ»ãƒ‘ã‚¿ãƒ˜ãƒæœ¬)ã«ã¯æ¬¡ã®ã‚ˆã†ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

> ALU(arithmetic logic unit)ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ç­‹è‚‰ã«ã‚ãŸã‚Šã€åŠ ç®—ã‚„æ¸›ç®—ãªã©ã®ç®—è¡“æ¼”ç®—ã‚„ANDã‚„ORãªã©ã®è«–ç†æ¼”ç®—ã‚’è¡Œã†ã‚‚ã®ã§ã‚ã‚‹ã€‚

ãƒ‘ã‚¿ãƒ˜ãƒæœ¬ã®èª¬æ˜ã«ã‚‚ã‚ã‚‹ã¨ãŠã‚Šã€ALUã¯ç®—è¡“æ¼”ç®—ãƒ»è«–ç†æ¼”ç®—ã¨ã„ã£ãŸã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿ã®æ¼”ç®—å‡¦ç†ã‚’è¡Œã†éå¸¸ã«é‡è¦ãªå›è·¯ã§ã™ã€‚

ã“ã“ã§ã€ä»Šå›å®Ÿè£…ã—ãŸALUã®æ§‹é€ ã¯ã€ç°¡ç•¥åŒ–ã—ãŸã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã™ãŒã€ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚

![image](https://user-images.githubusercontent.com/57289763/143207452-24c44544-3041-43f0-9811-812c3a705714.png)

x,yã¨ã„ã†16bitã®äºŒã¤ã®å…¥åŠ›ã«å¯¾ã—ã¦ã€ã©ã®ã‚ˆã†ãªæ¼”ç®—ã‚’æ–½ã™ã‹ï¼Ÿã¨ã„ã†ã®ã‚’6bitã®ALUæ“ä½œãƒ“ãƒƒãƒˆ(zx,nx,zy,ny,f,no)ã«ã‚ˆã£ã¦æ±ºå®šã—ã¦ã„ã¾ã™ã€‚

ãã‚Œã§ã¯ã€HDLã«ã‚ˆã‚‹ALUã®å®Ÿè£…ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
CHIP ALU {
    IN  
        // 16bit input
        x[16], y[16],
        // 6bit ALU operation
        zx, // zero the x input?
        nx, // negate the x input?
        zy, // zero the y input?
        ny, // negate the y input?
        f,  // compute out = x + y (if 1) or x & y (if 0)
        no; // negate the out output?

    OUT 
        out[16], // 16-bit output
        zr, // 1 if (out == 0), 0 otherwise
        ng; // 1 if (out < 0),  0 otherwise

    PARTS:

    // out x
    Mux16(a=x,b=false,sel=zx,out=outzx);
    Not16(in=outzx,out=notoutzx);
    Mux16(a=outzx,b=notoutzx,sel=nx,out=outx);
    // out y
    Mux16(a=y,b=false,sel=zy,out=outzy);
    Not16(in=outzy,out=notoutzy);
    Mux16(a=outzy,b=notoutzy,sel=ny,out=outy);

    // out fx
    Add16(a=outx,b=outy,out=addoutxy); 
    And16(a=outx,b=outy,out=andoutxy); 
    Mux16(a=andoutxy,b=addoutxy,sel=f,out=outfx);

    // out no
    Not16(in=outfx,out=notoutfx);
    Mux16(a=outfx,b=notoutfx,sel=no,out=outval);
    And16(a=outval,b=true,out=out);
    // ng
    IsNegative16(in=outval,out=ng);
    // zr
    Or16Way(in=outval,out=notzr);
    Not(in=notzr,out=zr);
}
```

6bit(zx,nx,zy,ny,f,no)ã®ALUæ“ä½œã‚’è¡¨ã™bitã«å¿œã˜ã¦ã€X,Y ã«å¯¾ã—ã¦é©åˆ‡ãªæ¼”ç®—ã‚’æ–½ã™ã‚ˆã†ãªå®Ÿè£…ãŒã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã¡ã‚‰ã«é–¢ã—ã¦ã‚‚å®Ÿè£…ç‰©ãŒãƒªãƒã‚¸ãƒˆãƒªã®[nand2tetris/hardware/alu](https://github.com/YadaYuki/nand2tetris-golang/tree/main/hardware/alu)ã«å­˜åœ¨ã™ã‚‹ã®ã§ã€èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ãœã²ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## 3.5.é †åºå›è·¯ã®å®Ÿè£…

å‰ç« ã¾ã§ã§ã€çµ„ã¿åˆã‚ã›å›è·¯ãŠã‚ˆã³ALUã®å®Ÿè£…ã«å–ã‚Šçµ„ã¿ã¾ã—ãŸã€‚ã“ã“ã¾ã§ã§å®Ÿè£…ã—ãŸå›è·¯ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ã€Œæ¼”ç®—ã€ã¨ã„ã†é‡è¦ãªå½¹å‰²ã‚’æ‹…ã„ã¾ã™ãŒã€ã€Œãã®å‡ºåŠ›ã¯å…¥åŠ›ã«ã®ã¿æ±ºå®šã—ã€å›è·¯è‡ªä½“ã¯çŠ¶æ…‹ã‚’æŒãŸãªã„ã€ã€ã™ãªã‚ã¡ã€ã€Œå€¤ã®è¨˜æ†¶ãŒã§ããªã„ã€ã¨ã„ã†é‡å¤§ãªæ¬ ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚

ãã“ã§ã€æ™‚é–“ãŒçµŒéã—ã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒä¿æŒã•ã‚Œã¦ã„ã‚‹è¨˜æ†¶ç´ å­ã€é †åºå›è·¯ã®å®Ÿè£…ã‚’æœ¬ç« ã§ã¯è¡Œã„ã¾ã™ã€‚çµ„ã¿åˆã‚ã›å›è·¯ã®å®Ÿè£…ã§ã¯Nandã‚²ãƒ¼ãƒˆãŒæœ€å°ç´ å­ã§ã—ãŸãŒã€æœ¬ç« ã§ã¯Dãƒ•ãƒªãƒƒãƒ—ãƒ•ãƒ­ãƒƒãƒ—(ä»¥å¾Œ,DFF)ã‚’æœ€å°ç´ å­ã¨ã—ã¦æ§˜ã€…ãªé †åºå›è·¯ã®å®Ÿè£…ã«å–ã‚Šçµ„ã¿ã¾ã™ã€‚

ã•ã¦ã€ã“ã“ã§æœ€å°ç´ å­ã¨ãªã‚‹DFFã®ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã€å…¥å‡ºåŠ›ã®é–¢ä¿‚ã‚’ç¤ºã—ã¦ãŠãã¾ã™ã€‚æ™‚åˆ»tã«ãŠã‘ã‚‹å‡ºåŠ›ã‚’$out(t)$,å…¥åŠ›ã‚’$in(t)$ã¨ã—ãŸæ™‚ã€DFFã®å…¥å‡ºåŠ›ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå¼ã§è¡¨ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

$$out(t) = in(t-1)$$

å¼ã‚’è¦‹ã‚‹ã¨ã‚ã‹ã‚‹ã¨ãŠã‚Šã€Dãƒ•ãƒªãƒƒãƒ—ãƒ•ãƒ­ãƒƒãƒ—ã¯1ã‚¯ãƒ­ãƒƒã‚¯å‰ã®å…¥åŠ›($in(t-1)$)ã‚’å‡ºåŠ›ã™ã‚‹ã ã‘ã®éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ãªé †åºå›è·¯ã§ã™ã€‚å›è·¯å›³ã§è¡¨ã™ã¨ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚

![image](https://user-images.githubusercontent.com/57289763/143163411-ca636874-cb03-40b5-ba74-01bc1e5dfda5.png)

æœ¬ç« ã§ã¯ã€DFFã‚’ç”¨ã„ã¦ã€å¤§ããåˆ†ã‘ã¦ä»¥ä¸‹ã®3ã¤ã®å›è·¯ã®å®Ÿè£…ã«å–ã‚Šçµ„ã¿ã¾ã—ãŸã€‚

- ãƒ¬ã‚¸ã‚¹ã‚¿
- ãƒ¡ãƒ¢ãƒª
- ã‚«ã‚¦ãƒ³ã‚¿

ã“ã‚Œã‚‰ã«ã¤ã„ã¦ã‚‚å®Ÿè£…ã®è©³ç´°ã¯ã“ã“ã§ã¯è§¦ã‚Œã¾ã›ã‚“ãŒã€å®Ÿè£…ç‰©ãŒãƒªãƒã‚¸ãƒˆãƒªã®[nand2tetris/hardware/sequential_circuit](https://github.com/YadaYuki/nand2tetris-golang/tree/main/hardware/sequential_circuit)ã«å­˜åœ¨ã™ã‚‹ã®ã§ã€èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ãœã²ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## 3.6.CPU(ä¸­å¤®æ¼”ç®—å‡¦ç†è£…ç½®)ã®å®Ÿè£…

ãã‚Œã§ã¯ã€3.4ã§å®Ÿè£…ã—ãŸALUã¨3.5ã§å®Ÿè£…ã—ãŸè¤‡æ•°ã®é †åºå›è·¯ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ä¸­å¤®æ¼”ç®—å‡¦ç†è£…ç½®ãƒ»CPUã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

CPUã¯æ©Ÿæ¢°èªã§æ›¸ã‹ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ã€æ¼”ç®—å‡¦ç†ã‚’è¡Œã£ãŸã‚Šã€æ¼”ç®—çµæœã®ãƒ¡ãƒ¢ãƒª(RAM)ã¸ã®æ›¸ãè¾¼ã¿ã‚’è¡Œã£ãŸã‚Šã™ã‚‹ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«ãŠã‘ã‚‹ã„ã‚ã°ä¸­å¿ƒçš„ãªå­˜åœ¨ã§ã™ã€‚

ä»Šå›å®Ÿè£…ã—ãŸCPUã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã‚’ã—ã¦ã„ã¾ã™ã€‚

![image](https://user-images.githubusercontent.com/57289763/143206032-d4a589df-8df3-459e-9a18-a96c330c1dbe.png)

ã“ã“ã§å…¥å‡ºåŠ›ã‚’ã‚ˆã‚Šã‚ã‹ã‚Šã‚„ã™ãã™ã‚‹ãŸã‚ã€ç°¡æ˜“åŒ–ã—ãŸCPUã®å›³ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

![image](https://user-images.githubusercontent.com/57289763/143576197-a153587b-9ec1-4786-bb15-9af99aa1c178.png)

ãã‚Œã§ã¯HDLã«ã‚ˆã‚‹å®Ÿè£…ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
CHIP CPU {
    IN  inM[16],         // M value input  (M = contents of RAM[A])
        instruction[16], // Instruction for execution
        reset;           // Signals whether to re-start the current
                         // program (reset==1) or continue executing
                         // the current program (reset==0).

    OUT outM[16],        // M value output
        writeM,          // Write to M? 
        addressM[15],    // Address in data memory (of M)
        pc[15];          // address of next instruction

    PARTS:

    // flag for ARegister
    Not(in=instruction[15], out=isA);
    Not(in=isA, out=isC);
    And(a=isC, b=instruction[5], out=ALUtoA);
    
    // Mux previous ARegister
    Mux16(a=ALUout,b=instruction,sel=isA,out=outMu);

    // ARegister
    Or(a=ALUtoA,b=isA,out=loadA);
    ARegister(in=outMu,load=loadA,out=A,out=out);

    // Define mnemonic(A or M)
    Mux16(a=A,b=inM,sel=instruction[12],out=AM);

    // DRegister
    And(a=isC, b=instruction[4], out=loadD);
    DRegister(in=outMu,load=loadD,out=D);

    // ALU
    ALU(x=D,y=AM,zx=instruction[11],nx=instruction[10],zy=instruction[9],ny=instruction[8],f=instruction[7],no=instruction[6],out=ALUout,zr=zr,ng=ng);

    // outM. not output directly from ALU,because of internal pin
    Or16(a=false,b=ALUout,out=outM);
    
    // writeM
    And(a=isC,b=instruction[3],out=writeM);

    // addressM
    Or16(a=false,b=A,out[0..14]=addressM);

    // PC
    // Calc isPositive
    Not(in=zr,out=nZr);
    Not(in=ng,out=nNg);
    And(a=nZr,b=nNg,out=isPositive);
    // JGT
    And(a=isPositive,b=instruction[0],out=JGT);
    // JEQ
    And(a=zr,b=instruction[1],out=JEQ);
    // JLT
    And(a=ng,b=instruction[2],out=JLT);
    // loadPc = JGT || JLT || JEQ
    Or(a=JGT,b=JLT,out=JNE);
    Or(a=JNE,b=JEQ,out=isJump);
    And(a=isC,b=isJump,out=loadPc);
    PC(in=A,load=loadPc,inc=true,reset=reset,out[0..14]=pc);
}
```

ä»¥ä¸ŠãŒCPUã®å®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚

## 3.7.ãƒã‚¤ãƒãƒ³å‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å®Ÿè£…

ã•ã¦ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç·¨ã®æœ€å¾Œã§ã¯ã„ã‚ˆã„ã‚ˆãƒã‚¤ãƒãƒ³å‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã“ã“ã§å®Ÿè£…ã™ã‚‹ãƒã‚¤ãƒãƒ³å‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¯

- å‘½ä»¤ãƒ¡ãƒ¢ãƒª(ROMãƒ»ROM32K):16bitã®æ©Ÿæ¢°èªã§æ›¸ã‹ã‚ŒãŸå‘½ä»¤ã‚’ä¿å­˜ã—ãŸãƒ¡ãƒ¢ãƒª
- ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒ¢ãƒª(RAMãƒ»Memory):ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§æ‰±ã†ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ãŸãƒ¡ãƒ¢ãƒª
- CPU:ä¸­å¤®æ¼”ç®—å‡¦ç†è£…ç½®ã€‚3.6ã§å®Ÿè£…ã€‚

ã¨ã„ã†æ—¢ã«å®Ÿè£…æ¸ˆã¿(è¨˜äº‹ã§ã¯è§¦ã‚Œã¦ã„ã¾ã›ã‚“ãŒ)ã®3ã¤ã®ãƒ‘ãƒ¼ãƒ„ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«é…ç·šã—ã¾ã™ã€‚

![image](https://user-images.githubusercontent.com/57289763/143576297-722d9fce-125b-4b6f-9506-48d8b63090ff.png)

CPUã®å®Ÿè£…ã¯è¤‡é›‘ã§ã—ãŸãŒã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å®Ÿè£…ã¯ã€ãã‚Œã‚’æ§‹æˆã™ã‚‹ãƒ‘ãƒ¼ãƒ„ã®å®Ÿè£…ãŒã§ãã¦ã„ã‚Œã°éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚ãã‚Œã§ã¯ã€HDLã«ã‚ˆã‚‹å®Ÿè£…ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
CHIP Computer {
    IN reset;
    PARTS:
    ROM32K(address=pc,out=instruction);
    CPU(inM=inM,instruction=instruction,reset=reset,outM=outM,writeM=writeM,addressM=addressM,pc=pc);
    Memory(in=outM,load=writeM,address=addressM,out=inM);
}
```

ä»¥ä¸ŠãŒãƒã‚¤ãƒãƒ³å‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚

# 4.æœ€å¾Œã«

æœ¬è¨˜äº‹ã§ã¯Nand2tetrisã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç·¨(1 ~ 5ç« )ã®å®Ÿè£…ã«é–¢ã™ã‚‹èª¬æ˜ã‚’è¡Œã„ã¾ã—ãŸã€‚ä»Šå›å®Ÿè£…ã—ãŸCPUã€ãƒã‚¤ãƒãƒ³å‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¯ç°¡æ˜“çš„ãªã‚‚ã®ã§ã™ãŒã€ãã‚Œã§ã‚‚æ§‹æˆã™ã‚‹è¦ç´ ãŒå¤šãã€ã‹ãªã‚Šçœç•¥ã—ã¦ã—ã¾ã£ãŸéƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚å®Ÿè£…ã®è©³ç´°ãŒæ°—ã«ãªã‚‹æ–¹ã¯ãƒªãƒã‚¸ãƒˆãƒªã®[nand2tetris-golang/hardware](https://github.com/YadaYuki/nand2tetris-golang/tree/main/hardware)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

1 ~ 5ç« ã§16bitã®æ©Ÿæ¢°èªãŒå‹•ä½œã™ã‚‹ã‚ˆã†ãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®å®Ÿè£…ã¯ã§ãã¾ã—ãŸã€‚ã—ã‹ã—ã€æ©Ÿæ¢°èªã‚’ç›´æ¥è¨˜è¿°ã™ã‚‹ã¨ã„ã†ã®ã¯ã€åŠ¹ç‡ãŒæ‚ªã„ã§ã™ã—ã€äººé–“çš„ãªä½œæ¥­ã¨ã‚‚è¨€ã„é›£ã„ã§ã™ã€‚ãã“ã§ã€æ¬¡ã®è¨˜äº‹ã§ã¯ã€nand2tetrisãŒæä¾›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’æ©Ÿæ¢°èªã«å¤‰æ›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒ©([nand2tetris-golang/assembler](https://github.com/YadaYuki/nand2tetris-golang/tree/main/assembler))ã®å®Ÿè£…ã‚’Golangã§è¡Œã„ã¾ã™ã€‚èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ãœã²ãã¡ã‚‰ã‚‚ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

https://zenn.dev/yukiyada/articles/44805448111905

# 5.å‚è€ƒæ–‡çŒ®

https://www.oreilly.co.jp/books/9784873117126/

https://www.amazon.co.jp/%E3%82%AD%E3%82%BF%E3%83%9F%E5%BC%8F%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88IT%E5%A1%BE-%E5%BF%9C%E7%94%A8%E6%83%85%E5%A0%B1%E6%8A%80%E8%A1%93%E8%80%85-%E4%BB%A4%E5%92%8C03%E5%B9%B4-%E3%81%8D%E3%81%9F%E3%81%BF%E3%82%8A%E3%82%85%E3%81%86%E3%81%98/dp/4297117835

https://www.amazon.co.jp/%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%81%AE%E6%A7%8B%E6%88%90%E3%81%A8%E8%A8%AD%E8%A8%88-%E7%AC%AC5%E7%89%88-%E4%B8%8A-%E3%82%B8%E3%83%A7%E3%83%B3%E3%83%BBL-%E3%83%98%E3%83%8D%E3%82%B7%E3%83%BC/dp/4822298426

https://www.amazon.co.jp/%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%81%AE%E6%A7%8B%E6%88%90%E3%81%A8%E8%A8%AD%E8%A8%88-%E7%AC%AC5%E7%89%88-%E4%B8%8B-%E3%83%87%E3%82%A4%E3%83%93%E3%83%83%E3%83%89%E3%83%BB-%E3%83%BB%E3%83%91%E3%82%BF%E3%83%BC%E3%82%BD%E3%83%B3/dp/4822298434/ref=pd_lpo_1?pd_rd_i=4822298434&psc=1


https://www.nand2tetris.org/

