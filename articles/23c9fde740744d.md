---
title: "Nand2tetrisをGoで実装する ~ コンパイラ(コンパイラ・フロントエンド)編(10,11章) ~"
emoji: "😺"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Go","nand2tetris","compiler"]
published: true
---

# Nand2tetrisを実装する・目次 
1. [Nand2tetrisを実装する  ~ ハードウェア編(1 ~ 5章) ~](https://zenn.dev/yukiyada/articles/1c5708ddfb36db)
2. [Nand2tetrisをGoで実装する ~ アセンブラ編(6章) ~](https://zenn.dev/yukiyada/articles/44805448111905)
3. [Nand2tetrisをGoで実装する ~ 中間言語・VM(コンパイラ・バックエンド)編(7,8章) ~](https://zenn.dev/yukiyada/articles/f90cf5fa34073c)
4. **Nand2tetrisをGoで実装する ~ コンパイラ(コンパイラ・フロントエンド)編(10,11章) ~**

# 1.はじめに

タイトルにもあるとおり、本記事は「コンピュータシステムの理論と実装」の10,11章に該当するコンパイラ(コンパイラ・フロントエンド)編の実装に関する記事です。

本記事で紹介するjackcompilerというGoで実装したコンパイラは、Nand2tetrisが提供するプログラミング言語であるJackを中間言語にコンパイルします。

jackcompilerを通して得られた中間言語を、前の記事までに実装したvmtranslator,assemblerという2つのソフトウェアによって機械語に変換すれば、高級言語Jackによるプログラムを機械語に変換することができます。

すなわち、今回実装したjackcompilerとvmtranslator,assemblerという3つのソフトウェアを使えば、**高級言語のJackによって、ハードウェアを操作することがついにできるようになる**ということです！

それでは、Jackの文法とJackを中間言語に変換するコンパイラの実装を見ていきましょう。

# 2.プログラミング言語・Jackの文法

その実装について解説していく前に、**コンパイルをする対象である「Jack」というプログラミング言語**を簡単に説明していきます。

「Jackがどんな言語なのか？」を直感的に把握してもらうために、Jackで記述されたプログラムを見ていきましょう。以下は「長さ`length`を持つ配列`a`の各要素に標準入力から値を入力していき、その平均値を出力する」という処理を行うJackプログラムです。

```
class Main {
   function void main() {
     var Array a; 
     var int length;
     var int i, sum;

     let length = Keyboard.readInt("How many numbers? ");
     let a = Array.new(length); 
     
     let i = 0;
     while (i < length) {
        let a[i] = Keyboard.readInt("Enter a number: ");
        let sum = sum + a[i];
        let i = i + 1;
     }
     
     do Output.printString("The average is ");
     do Output.printInt(sum / length);
     return;
   }
}
```

普段私たちが慣れ親しんでいるプログラミング言語とほとんど同じように見えませんか？文法の解説に関しては、次の記事に譲りますが、今回そのコンパイラを実装していく「Jack」というプログラミング言語には以下のような特徴があります。

- オブジェクト指向型言語
- 静的型付け
- コンパイル時、直接実行可能な機械語・アセンブリには変換されず、独自のVirtual Machine上で動作する中間コードに変換される。(like Java,Scala,Kotlin & JVM)

# 4.Jackによるプログラムが機械語に変換されるまで.

前章で今回コンパイルする「Jack」というプログラミング言語について簡単に紹介しました。しかし、Jackという「高級言語」で記述されたプログラムをハードウェア上で直接動作させることは、当然できません。

高級言語により記述されたプログラムをハードウェア上で実行するためには、**プログラムを実行させたいハードウェア・プラットホーム上で動作するような機械語に最終的には変換する必要があります**。

それでは、ここで「Jackによるプログラム」が「Nand2tetrisが提供するハードウェア上で動作する16bit機械語」に変換されるまでの全体像を改めて見てみましょう.

![image](https://user-images.githubusercontent.com/57289763/144741977-722b2d98-7595-48a2-af1f-b7b02e296642.png)

Jack言語によるプログラムは「中間言語」「アセンブリ」という二つの形態を経て、最終的に16bit機械語に変換されます。そして本記事で解説するのは**中間言語をHackプラットホーム上で動作するようなアセンブリに変換するVirtual Machine**のGo言語による実装です。

# 4. GoによるJackコンパイラの実装

## 4.1 Jackによるプログラムが中間言語に変換されるまで

## 4.2 Goで作るインタプリタ

## 4.3 jackcompilerのフォルダ構成

## 4.4 字句解析器の実装

## 4.5 構文木の定義

## 4.6 中間言語への変換・評価

## 5. 最後に